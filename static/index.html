<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Workspace</title>
    <script>
      (() => {
        let theme = "light";
        try {
          const savedTheme = localStorage.getItem("workspace-theme");
          if (savedTheme === "dark" || savedTheme === "light") theme = savedTheme;
        } catch {
          // Ignore storage errors and keep light default.
        }
        document.documentElement.dataset.theme = theme;
        window.__workspaceTheme = theme;
      })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              ink: {
                50: 'var(--ink-50)', 100: 'var(--ink-100)', 200: 'var(--ink-200)',
                300: 'var(--ink-300)', 400: 'var(--ink-400)', 500: 'var(--ink-500)',
                600: 'var(--ink-600)', 700: 'var(--ink-700)', 800: 'var(--ink-800)',
                900: 'var(--ink-900)', 950: 'var(--ink-950)',
              },
              brand: { DEFAULT: 'var(--brand)', light: 'var(--brand-light)', dark: 'var(--brand-dark)' },
            },
            fontFamily: {
              sans: ['"DM Sans"', 'ui-sans-serif', 'system-ui', 'sans-serif'],
              mono: ['"JetBrains Mono"', 'ui-monospace', 'monospace'],
            },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />
    <link id="hljs-theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" />
    <script>
      if (window.__workspaceTheme === "dark") {
        const hljsTheme = document.getElementById("hljs-theme");
        if (hljsTheme) {
          hljsTheme.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css";
        }
      }
    </script>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="bg-ink-950 text-ink-100 font-sans h-[100dvh] flex flex-col overflow-hidden">

    <!-- Top bar -->
    <header class="shrink-0 bg-ink-900 border-b border-ink-800 px-4 py-2.5 flex items-center gap-3 z-30">
      <h1 class="text-sm font-bold tracking-wide uppercase text-ink-400 shrink-0">Workspace</h1>
      <div class="flex-1"></div>
      <button id="theme-toggle-btn" type="button" class="p-1.5 text-ink-500 hover:text-ink-300 rounded-lg hover:bg-ink-800 transition-colors" title="Toggle theme">
        <i data-lucide="sun" class="w-4 h-4"></i>
      </button>
      <div id="status" class="text-[11px] text-ink-500 font-mono truncate max-w-52"></div>
    </header>

    <!-- Tab panels (only one visible at a time) -->
    <div class="flex-1 min-h-0 relative">

      <!-- Tab: Clipboard -->
      <section id="panel-clipboard" class="tab-panel absolute inset-0 flex flex-col hidden">
        <div class="shrink-0 bg-ink-900/60 border-b border-ink-800 px-4 py-3 flex flex-wrap items-center gap-2">
          <label class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-brand bg-brand-light/10 border border-brand/20 rounded-lg cursor-pointer hover:bg-brand-light/20 transition-colors">
            <i data-lucide="image-plus" class="w-3.5 h-3.5"></i>
            Choose
            <input id="upload-input" type="file" accept="image/*" hidden />
          </label>
          <button id="paste-clipboard-btn" type="button" class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-ink-300 bg-ink-800 border border-ink-700 rounded-lg hover:bg-ink-700 transition-colors">
            <i data-lucide="clipboard-paste" class="w-3.5 h-3.5"></i>
            Paste
          </button>
          <input
            id="upload-name-input"
            type="text"
            placeholder="filename.png"
            class="px-2.5 py-1.5 text-sm font-mono bg-ink-800 border border-ink-700 rounded-lg w-40 focus:outline-none focus:ring-2 focus:ring-brand/40 focus:border-brand placeholder:text-ink-600 text-ink-200"
          />
          <button id="upload-btn" type="button" class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-semibold text-white bg-brand rounded-lg hover:bg-brand-dark transition-colors">
            <i data-lucide="upload" class="w-3.5 h-3.5"></i>
            Upload
          </button>
          <button id="clipboard-refresh-btn" type="button" class="p-1.5 text-ink-500 hover:text-ink-300 rounded-lg hover:bg-ink-800 transition-colors ml-auto" title="Refresh">
            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
          </button>
        </div>
        <div id="clipboard-status" class="shrink-0 px-4 py-1 text-[11px] text-ink-500 font-mono min-h-[1.4em]"></div>
        <div id="clipboard-grid" class="flex-1 overflow-y-auto overscroll-contain p-3 grid grid-cols-[repeat(auto-fill,minmax(140px,1fr))] gap-3 content-start"></div>
      </section>

      <!-- Tab: Files -->
      <section id="panel-files" class="tab-panel absolute inset-0 flex flex-col">
        <!-- Search bar -->
        <div class="shrink-0 bg-ink-900/60 border-b border-ink-800 px-4 py-2.5 flex items-center gap-2">
          <div class="relative flex-1">
            <i data-lucide="search" class="absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-ink-500 pointer-events-none"></i>
            <input
              id="search-input"
              type="text"
              placeholder="Search files..."
              class="w-full pl-8 pr-3 py-1.5 text-sm font-mono bg-ink-800 border border-ink-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/40 focus:border-brand placeholder:text-ink-600 text-ink-200 transition-colors"
            />
            <div id="search-results" class="hidden absolute top-full left-0 right-0 mt-1 bg-ink-800 border border-ink-700 rounded-lg shadow-xl max-h-72 overflow-y-auto z-40"></div>
          </div>
          <button id="tree-refresh-btn" type="button" class="hidden lg:inline-flex p-1.5 text-ink-500 hover:text-ink-300 rounded-lg hover:bg-ink-800 transition-colors" title="Refresh">
            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
          </button>
        </div>
        <!-- Split: tree + preview (desktop) / single panel (mobile) -->
        <div class="flex-1 min-h-0 flex flex-col lg:flex-row">
          <div id="file-tree-container" class="flex-1 min-h-0 lg:flex-none lg:w-72 lg:min-w-[220px] lg:max-w-[360px] border-b lg:border-b-0 lg:border-r border-ink-800">
            <div id="file-tree" class="h-full overflow-y-auto overscroll-contain px-1 py-1"></div>
          </div>
          <div id="file-viewer-container" class="hidden flex flex-1 min-h-0 flex-col lg:flex">
            <div class="shrink-0 flex items-center gap-2 px-4 py-2 border-b border-ink-800/60">
              <button id="mobile-explorer-back-btn" type="button" class="hidden lg:hidden p-1 text-ink-500 hover:text-ink-300 rounded-lg hover:bg-ink-800 transition-colors" title="Back to files">
                <i data-lucide="arrow-left" class="w-3.5 h-3.5"></i>
              </button>
              <i data-lucide="eye" class="hidden lg:block w-3.5 h-3.5 text-ink-500"></i>
              <button id="viewer-refresh-btn" type="button" class="order-2 lg:order-none lg:ml-auto p-1 text-ink-500 hover:text-ink-300 rounded-lg hover:bg-ink-800 transition-colors hidden" title="Refresh file">
                <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i>
              </button>
              <span id="viewer-title" class="order-3 lg:order-none min-w-0 flex-1 text-xs font-mono text-ink-400 truncate">Select a file</span>
            </div>
            <div id="viewer" class="flex-1 overflow-y-auto overscroll-contain p-4">
              <div class="flex flex-col items-center justify-center h-full text-ink-600">
                <i data-lucide="file-search" class="w-10 h-10 mb-2 opacity-30"></i>
                <p class="text-sm">Select a file to preview</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Lightbox overlay -->
      <div id="lightbox" class="hidden absolute inset-0 z-50 bg-ink-950/90">
        <!-- Modal panel -->
        <div id="lightbox-panel" class="absolute inset-6 bg-ink-900 rounded-xl shadow-2xl flex flex-col overflow-hidden">
          <div class="shrink-0 flex items-center justify-end px-3 pt-3">
            <button id="lightbox-close-btn" type="button"
              class="p-1.5 text-ink-400 hover:text-ink-200 hover:bg-ink-800 rounded-lg transition-colors">
              <i data-lucide="x" class="w-5 h-5"></i>
            </button>
          </div>
          <div id="lightbox-content" class="flex-1 min-h-0 flex items-center justify-center p-4 pt-0">
            <img id="lightbox-img" class="hidden max-w-full max-h-full object-contain rounded-lg" />
            <div id="lightbox-svg-container" class="hidden w-full h-full"></div>
          </div>
        </div>
      </div>

    </div>

    <!-- Bottom tab bar -->
    <nav class="shrink-0 bg-ink-900 border-t border-ink-800 flex z-30 safe-bottom">
      <button type="button" class="tab-btn flex-1 flex flex-col items-center gap-0.5 py-2.5 text-ink-500 transition-colors" data-tab="files">
        <i data-lucide="folder-tree" class="w-5 h-5"></i>
        <span class="text-[10px] font-semibold uppercase tracking-wide">Files</span>
        <span id="tab-badge-files" class="text-[9px] font-mono text-ink-600"></span>
      </button>
      <button type="button" class="tab-btn flex-1 flex flex-col items-center gap-0.5 py-2.5 text-ink-500 transition-colors" data-tab="clipboard">
        <i data-lucide="clipboard" class="w-5 h-5"></i>
        <span class="text-[10px] font-semibold uppercase tracking-wide">Clipboard</span>
        <span id="tab-badge-clipboard" class="text-[9px] font-mono text-ink-600"></span>
      </button>
    </nav>

    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/diff.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14/dist/markdown-it.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <script src="/app.js"></script>
  </body>
</html>
